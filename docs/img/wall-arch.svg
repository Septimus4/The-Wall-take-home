<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600">
  <defs>
    <style>
      .service-box { fill: #e3f2fd; stroke: #1976d2; stroke-width: 2; }
      .database-box { fill: #f3e5f5; stroke: #7b1fa2; stroke-width: 2; }
      .messaging-box { fill: #e8f5e8; stroke: #388e3c; stroke-width: 2; }
      .monitoring-box { fill: #fff3e0; stroke: #f57c00; stroke-width: 2; }
      .text { font-family: Arial, sans-serif; font-size: 12px; text-anchor: middle; }
      .title-text { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; text-anchor: middle; }
      .arrow { stroke: #666; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="400" y="30" class="title-text" style="font-size: 18px;">Wall v0.1 - System Architecture</text>

  <!-- Client -->
  <rect x="50" y="80" width="100" height="60" class="service-box" />
  <text x="100" y="105" class="title-text">Client</text>
  <text x="100" y="120" class="text">HTTP Requests</text>

  <!-- API Gateway -->
  <rect x="200" y="80" width="120" height="60" class="service-box" />
  <text x="260" y="100" class="title-text">API Gateway</text>
  <text x="260" y="115" class="text">Django REST</text>
  <text x="260" y="128" class="text">Port: 8000</text>

  <!-- Simulation Service -->
  <rect x="200" y="180" width="120" height="60" class="service-box" />
  <text x="260" y="200" class="title-text">Simulator</text>
  <text x="260" y="215" class="text">FastAPI</text>
  <text x="260" y="228" class="text">Port: 8001</text>

  <!-- Materializer -->
  <rect x="200" y="280" width="120" height="60" class="service-box" />
  <text x="260" y="300" class="title-text">Materializer</text>
  <text x="260" y="315" class="text">Django Mgmt</text>
  <text x="260" y="328" class="text">Command</text>

  <!-- Kafka -->
  <rect x="400" y="180" width="120" height="120" class="messaging-box" />
  <text x="460" y="200" class="title-text">Apache Kafka</text>
  <text x="460" y="220" class="text">+ Schema Registry</text>
  <text x="460" y="240" class="text">Topics:</text>
  <text x="460" y="255" class="text">• profile-events</text>
  <text x="460" y="270" class="text">• simulation-events</text>
  <text x="460" y="285" class="text">Port: 9092</text>

  <!-- PostgreSQL -->
  <rect x="50" y="380" width="100" height="80" class="database-box" />
  <text x="100" y="405" class="title-text">PostgreSQL</text>
  <text x="100" y="420" class="text">Primary DB</text>
  <text x="100" y="435" class="text">Profiles</text>
  <text x="100" y="450" class="text">Simulations</text>

  <!-- Prometheus -->
  <rect x="550" y="120" width="100" height="60" class="monitoring-box" />
  <text x="600" y="145" class="title-text">Prometheus</text>
  <text x="600" y="160" class="text">Metrics</text>
  <text x="600" y="175" class="text">Port: 9090</text>

  <!-- Grafana -->
  <rect x="550" y="200" width="100" height="60" class="monitoring-box" />
  <text x="600" y="225" class="title-text">Grafana</text>
  <text x="600" y="240" class="text">Dashboards</text>
  <text x="600" y="255" class="text">Port: 3000</text>

  <!-- Arrows -->
  <!-- Client to API Gateway -->
  <line x1="150" y1="110" x2="200" y2="110" class="arrow" />
  <text x="175" y="105" class="text">HTTP</text>

  <!-- API Gateway to Database -->
  <line x1="200" y1="130" x2="150" y2="380" class="arrow" />
  <text x="175" y="250" class="text" transform="rotate(-45 175 250)">SQL</text>

  <!-- API Gateway to Kafka -->
  <line x1="320" y1="110" x2="400" y2="210" class="arrow" />
  <text x="360" y="150" class="text">Events</text>

  <!-- Kafka to Simulator -->
  <line x1="400" y1="220" x2="320" y2="210" class="arrow" />
  <text x="360" y="205" class="text">Consume</text>

  <!-- Simulator to Kafka -->
  <line x1="320" y1="230" x2="400" y2="250" class="arrow" />
  <text x="360" y="245" class="text">Publish</text>

  <!-- Kafka to Materializer -->
  <line x1="400" y1="280" x2="320" y2="290" class="arrow" />
  <text x="360" y="275" class="text">Progress</text>

  <!-- Materializer to Database -->
  <line x1="200" y1="320" x2="150" y2="380" class="arrow" />
  <text x="175" y="350" class="text">Update</text>

  <!-- Services to Prometheus -->
  <line x1="320" y1="110" x2="550" y2="150" class="arrow" stroke-dasharray="5,5" />
  <line x1="320" y1="210" x2="550" y2="150" class="arrow" stroke-dasharray="5,5" />
  <text x="450" y="130" class="text">Metrics</text>

  <!-- Prometheus to Grafana -->
  <line x1="600" y1="180" x2="600" y2="200" class="arrow" />

  <!-- Event Flow Legend -->
  <g transform="translate(50, 500)">
    <text x="0" y="0" class="title-text">Event Flow:</text>
    <text x="0" y="20" class="text">1. Client creates profile → API Gateway</text>
    <text x="0" y="35" class="text">2. API Gateway publishes ProfileCreated → Kafka</text>
    <text x="0" y="50" class="text">3. Simulator consumes event → runs simulation</text>
    <text x="0" y="65" class="text">4. Simulator publishes SimulationProgress → Kafka</text>
    <text x="0" y="80" class="text">5. Materializer updates cost calculations → Database</text>
  </g>

  <!-- Technology Stack -->
  <g transform="translate(400, 400)">
    <text x="0" y="0" class="title-text">Technology Stack:</text>
    <text x="0" y="20" class="text">• Python 3.12+ with Poetry</text>
    <text x="0" y="35" class="text">• Django REST Framework</text>
    <text x="0" y="50" class="text">• FastAPI with async/await</text>
    <text x="0" y="65" class="text">• Apache Kafka + Avro</text>
    <text x="0" y="80" class="text">• PostgreSQL / SQLite</text>
    <text x="0" y="95" class="text">• Docker Compose</text>
  </g>
</svg>
